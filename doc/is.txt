0FRRRRRSSSSSOOOO...........TTTTT
1FRRRRRSSSSSOOOOIIIIIIIIIIIIIIII

todo
	flags out
	ram control
	halt gating

F: don't update flags
O: operation
R: destination register
	though it's actually the source register in the case of ld
S: primary source register
I: secondary source immediate
T: secondary source register

0000: mov destination, secondary
0001: jmp destination, secondary
	primary encodes conditions instead of a register
	destination receives a pointer to just after the jmp
	instruction pointer receives secondary
0010: ld destination, primary + secondary
0011: exh destination, primary
	dest[31:16] = sec[15: 0]
	dest[15: 0] = pri[31:16]
0100: sub destination, primary, secondary
	primary is subtracted from secondary
0101: sbb destination, primary, secondary
	primary is subtracted from secondary
0110: add destination, primary, secondary
0111: adc destination, primary, secondary
1000: shl destination, primary, secondary
1001: shr destination, primary, secondary
1010: st destination, primary + secondary
1011: hlt
1100: and destination, primary, secondary
1101: or destination, primary, secondary
1110: xor destination, primary, secondary
1111: clr destination, primary, secondary

i/o
	address
		bit 16: internal write
		bit 17: external write
		bit 18: internal read
		bit 19: external read
	data out
	response
		bit 0: wait
		bit 3: override result
			idk maybe this should be automatically set on external reads
	data in

flag layout in corestate: Cf Of Zf Sf
flag layout when checking condition:
	.BNT..Z.
	...T....
	L.NT...S
	.BNTC.Z.
	.B.TC...
	LBNTC..S
	LBNT.OZ.
	L.NT.O..
	...T.O.S
	LBNTCOZ.
	LBNTCO..
	.B.TCO.S

BEf = Cf || Zf
NGf = Zf || Sf != Of
Lf = Sf != Of

non-memory cycle
	fetch, execute, fetchnext
read cycle
	fetch, execute, read, execute, fetchnext
write cycle
	fetch, execute, fetchnext, finishwrite, write

inputs:  pri  sec       ram      corestate fwinstr cinstr
outputs: dest dest_addr ram_addr corestate fwinstr cinstr

non-memory cycle
	ram = ram_read('ram_addr)
	instr_aw = ram
	instr = ram
	r_addr_1, r_addr_2, r_addr_w = decode_instr(instr)
	imm = decode_instr(ram)
	reg_1 = reg_read(r_addr_1)
	reg_2 = reg_read(r_addr_2)
	pri = reg_1
	sec = select_sec(reg_2, imm, instr)
	result, alu_flags = alu(instr, pri, sec)
	reg_write(r_addr_w, result)
	outputs
		flags' = select_flags(instr, flags, alu_flags)
		pc' = incr_pc('pc)
		curr_instr' = instr
		ram_addr' = pc'
read first cycle
	ram = ram_read('ram_addr)
	instr_aw = ram
	instr = ram
	r_addr_1, r_addr_2, r_addr_w = decode_instr(instr)
	imm = decode_instr(ram)
	reg_1 = reg_read(r_addr_1)
	reg_2 = reg_read(r_addr_2)
	pri = reg_1
	sec = select_sec(reg_2, imm, instr)
	result, alu_flags = alu(instr, pri, sec)
	reg_write(r_addr_w, result)
	outputs
		flags' = select_flags(instr, flags, alu_flags)
		pc' = incr_pc('pc)
		curr_instr' = instr
		ram_addr' = result # different from NM
read second cycle
	ram = ram_read('ram_addr)
	instr_aw = ram
	instr = 'curr_instr # different from NM and R
	r_addr_1, r_addr_2, r_addr_w = decode_instr(instr)
	imm = decode_instr(ram)
	reg_1 = reg_read(r_addr_1)
	reg_2 = reg_read(r_addr_2)
	pri = reg_1
	sec = select_sec(reg_2, imm, instr)
	result, alu_flags = alu(instr, pri, sec)
	reg_write(r_addr_w, result)
	outputs
		flags' = select_flags(instr, flags, alu_flags)
		pc' = 'pc # different from NM and R
		curr_instr' = instr
		ram_addr' = pc'
write first cycle
	ram = ram_read('ram_addr)
	instr_aw = ram
	instr = ram
	r_addr_1, r_addr_2, r_addr_w = decode_instr(instr)
	imm = decode_instr(ram)
	reg_1 = reg_read(r_addr_1)
	reg_2 = reg_read(r_addr_2)
	pri = reg_1
	sec = select_sec(reg_2, imm, instr)
	result, alu_flags = alu(instr, pri, sec)
	reg_write(0, result) # different from NM and R
	outputs
		flags' = select_flags(instr, flags, alu_flags)
		pc' = incr_pc('pc)
		curr_instr' = instr
		ram_addr' = pc'
write second cycle
	ram = ram_read('ram_addr)
	instr_aw = ram
	instr = 'curr_instr # different from NM and R
	r_addr_1, r_addr_2, r_addr_w = decode_instr(instr)
	imm = decode_instr(ram)
	reg_1 = reg_read(r_addr_1)
	reg_2 = reg_read(r_addr_2)
	pri = reg_1
	sec = select_sec(reg_2, imm, instr)
	result, alu_flags = alu(instr, pri, sec)
	reg_write(0, result) # different from NM and R
	outputs
		flags' = select_flags(instr, flags, alu_flags)
		pc' = 'pc # different from NM and R
		curr_instr' = instr
		ram_addr' = pc'
any cycle after write
	ram = instr_aw # different from everything else
